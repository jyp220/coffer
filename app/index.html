<!doctype html>
<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="generator" content="Coffer">
  <title>Coffer</title>

  <!-- Place favicon.ico in the `app/` directory -->

  <!-- Chrome for Android theme color -->
  <meta name="theme-color" content="#2E3AA1">

  <!-- Web Application Manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Tile color for Win8 -->
  <meta name="msapplication-TileColor" content="#3372DF">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="PSK">
  <link rel="icon" sizes="192x192" href="images/touch/chrome-touch-icon-192x192.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Coffer">
  <link rel="apple-touch-icon" href="images/touch/apple-touch-icon.png">

  <!-- Tile icon for Win8 (144x144) -->
  <meta name="msapplication-TileImage" content="images/touch/ms-touch-icon-144x144-precomposed.png">

  <!-- build:css styles/main.css -->
  <link rel="stylesheet" href="styles/main.css">
  <!-- endbuild-->

  <!-- build:js bower_components/webcomponentsjs/webcomponents-lite.min.js -->
  <script src="bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>

  <script type="text/javascript">
    var isIPHONE = (navigator.userAgent.match('iPhone') != null || navigator.userAgent.match('iPod') != null);
    var isIPAD = (navigator.userAgent.match('iPad') != null);
    var isANDROID = (navigator.userAgent.match('Android') != null);
    var SCHEME_FOR_TEST = 'intent://open#Intent;scheme=naversearchapp;action=android.intent.action.VIEW;category=android.intent.category.BROWSABLE;package=com.nhn.android.search;end';
    function executeApp(url) {
      if(isIPHONE || isIPAD) {
        this.is_installed_app_ios(url);
      } else  {
        this.is_installed_app_and(url);
      }
    }
    
    
    function setParams(params) {
        this.appURI = params.appURI;
        this.fallbackURL = params.fallbackURL;
    }

    function _createHiddenIframe() {
        var iframe = document.createElement('IFRAME');

        iframe.style.display = 'none';
        return iframe;
    }

    function _launchAppViaIframe() {
        var iframe = this._createHiddenIframe(),
            start = +new Date(),
            self = this;

        iframe.src = self.appURI;
        iframe.addEventListener('load', function onload() {
            iframe.removeEventListener('load', onload);
            document.body.removeChild(iframe);
        });
        document.body.appendChild(iframe);

        setTimeout(function() {
            var now = +new Date();
            if (now - start < 2000) {
                top.location.href = self.fallbackURL;
            }
        }, 500);
    }

    function _checkSupportingFallbackURL() {
        var iframe = this._createHiddenIframe(),
            self = this;

        iframe.addEventListener('load', function onload() {
            if (iframe.src === SCHEME_FOR_TEST) {
                self.isNotSupportedFallbackURL = true;
            } else {
                iframe.removeEventListener('load', onload);
                document.body.removeChild(iframe);
                self.isPrepared = true;
            }
        });
        iframe.src = SCHEME_FOR_TEST;

        document.body.appendChild(iframe);
        setTimeout(function() {
            iframe.src = '';
        }, 100);
    }

    function _launchAppViaIntent() {
        var popup,
            self = this;

        if (!this.isPrepared) {
            setTimeout(this.load.bind(this), 100);
            return;
        }

        if (!this.isNotSupportedFallbackURL) {
            window.location.href = self.appURI;
            return;
        }

        popup = window.open('');
        if (popup) {
            popup.addEventListener('unload', function onUnload() {
                setTimeout(function () {
                    if (popup.opener) {
                        popup.opener.location.href = self.fallbackURL;
                    }
                }, 10);
                popup.close();
                popup.removeEventListener('unload', onUnload);
            });
            popup.location.href = this.appURI.replace(/package=.*?;/, '');
        } else {
            alert('팝업 허용해주세요');
        }
    }

    function load() {
        alert('load() is not implemented!');
    }

    function _checkSupportingFallbackURL() {
        var iframe = this._createHiddenIframe(),
            self = this;

        iframe.addEventListener('load', function onload() {
            if (iframe.src === SCHEME_FOR_TEST) {
                self.isNotSupportedFallbackURL = true;
            } else {
                iframe.removeEventListener('load', onload);
                document.body.removeChild(iframe);
                self.isPrepared = true;
            }
        });
        iframe.src = SCHEME_FOR_TEST;

        document.body.appendChild(iframe);
        setTimeout(function() {
            iframe.src = '';
        }, 100);
    }
     
    function is_installed_app_and(url)
    {
      this._checkSupportingFallbackURL();
      this.load = this._launchAppViaIntent;



    //     var macketUrl = 'https://play.google.com/store/apps/details?id=com.kakao.talk&hl=ko';
    //     install_and( macketUrl );
    //  
    //     $("#div_app").html( "<iframe id='frm' src='" + url + "' width=0 height=0 frameborder=0></iframe>" );
    //     setTimeout(function () {
    //         var div = $("#div_app");
    //         var iframe = $("#frm");
    //         if( iframe.length > 0)
    //         {
    //             iframe.remove();
    //         }
    //     }, 1000 );
     
    }
    function install_and( macketUrl )
    {
        var clickedAt = +new Date();
        setTimeout( function () {
            if(+new Date() - clickedAt < 2000) 
            {
                location.href = macketUrl;
            }
        }, 1500);
    }
  </script>
<!--   <script src="bower_components/qrjs/qr.js"></script>
  <script src="bower_components/qr-code/src/qr-code.js"></script> -->


  <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
  <!-- endbuild -->

  <!-- Because this project uses vulcanize this should be your only html import
       in this file. All other imports should go in elements.html -->
  <link rel="import" href="elements/elements.html">

  <!-- For shared styles, shared-styles.html import in elements.html -->
  <!-- <style is="custom-style" include="shared-styles"></style> -->
  <style>
    
    :host {
      display: block;
      position: relative;
      padding-top: 80px;
      padding-bottom: 64px;
    }
    iron-pages {
      max-width: 1440px;
      margin: 0 auto;margin-top:15px;
    }

    .announcer {
      position: fixed;
      height: 0;
      overflow: hidden;
    }

    :host() .back-btn {
      display: none;
    }

    [hidden] {
      display: none !important;
    }

    .drawer-list {
      margin: 0 20px;
    }

    .drawer-list a {
      display: block;
      padding: 0 16px;
      line-height: 40px;
      text-decoration: none;
      color: var(--app-secondary-color);
    }

    .drawer-list a.iron-selected {
      color: black;
      font-weight: bold;
    }

    app-drawer {
      z-index: 3;
    }

    footer {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      text-align: center;
      margin: 20px;
      line-height: 24px;
    }

    footer > a {
      color: var(--app-secondary-color);
      text-decoration: none;
    }

    footer > a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body unresolved>
  <!-- <a href="kakaolink://" onclick="executeApp(this.href);return false;">네이버앱 실행</a><br />
  <div id="div_app"></div> -->

  <span id="browser-sync-binding"></span>

  <template is="dom-bind" id="app">
    <coffer-category-data categories="{{categories}}"></coffer-category-data>
    <things-setting id="setting" hidden></things-setting>
    <script type="text/javascript">
      // var app = document.querySelector('#content');
      var setting = document.querySelector('#setting');
      window.addEventListener('WebComponentsReady', function() {
          if (setting){
            setting.set('globals.baseUrl', 'http://192.168.35.96:8001/rest');
          }
      });
    </script>

    <coffer-header categories="[[categories]]" route="[[route]]" params="[[params]]"></coffer-header>

    <div class="content">
      <iron-pages role="main" attr-for-selected="data-route" selected="{{route}}" selected-attribute="visible">
        <coffer-home data-route="home" categories="[[categories]]"></coffer-home>
        <coffer-unit-list data-route="unit-list"></coffer-unit-list>
        <coffer-unit-detail-list data-route="unit-detail-list" route="[[route]]" params="[[params]]"></coffer-unit-detail-list>
        <coffer-coffer-list data-route="coffer-list"></coffer-coffer-list>
        <coffer-coffer-detail-list data-route="coffer-detail-list" route="[[route]]" params="[[params]]"></coffer-coffer-detail-list>
        <!-- <coffer-linkedin-login data-route="login"></coffer-linkedin-login> -->
        <things-login data-route="login" route="[[route]]" title="Things" login-path="login" content-type="application/x-www-form-urlencoded" success-route="/" username-input-label="ID" password-input-label="Password" submit-label="sign_up" reset-label="Reset"></things-login>
        <!-- <things-logout data-route="logout" action="logout" icon="exit-to-app"></things-logout> -->
      </iron-pages>
    </div>

    <paper-toast id="toast">
      <span class="toast-hide-button" role="button" tabindex="0" onclick="app.$.toast.hide()">Ok</span>
    </paper-toast>

  </template>

  <script src="scripts/app.js"></script>
</body>

</html>
